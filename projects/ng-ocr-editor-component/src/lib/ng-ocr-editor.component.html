<div *ngIf="menu" class="menu-control">
  <button mat-icon-button (click)="toViewMode()" *ngIf="mode.isEdit()" [matTooltip]="'demo'">
    <mat-icon>visibility</mat-icon>
  </button>
  <button mat-icon-button (click)="toEditMode()" *ngIf="mode.isView()" [matTooltip]="'edit'">
    <mat-icon>edit</mat-icon>
  </button>
  <button mat-icon-button (click)="zoomIn()" [matTooltip]="'markup.zoom_in'">
    <mat-icon>zoom_in</mat-icon>
  </button>
  <button mat-icon-button (click)="zoomOut()" [matTooltip]="'markup.zoom_out'">
    <mat-icon>zoom_out</mat-icon>
  </button>
  <button mat-icon-button (click)="selectAll()" *ngIf="mode.isEdit()" [matTooltip]="'markup.select_all'">
    <mat-icon>done_all</mat-icon>
  </button>
  <button mat-icon-button (click)="deselectAll()" *ngIf="mode.isEdit()" [matTooltip]="'markup.cancel'">
    <mat-icon>remove_done</mat-icon>
  </button>
  <button mat-icon-button (click)="deleteSelected()" *ngIf="mode.isEdit()"
    [matTooltip]="'markup.delete_selected'">
    <mat-icon>clear</mat-icon>
  </button>
  <button mat-icon-button (click)="mergeSelection()" *ngIf="mode.isEdit()" [matTooltip]="'markup.merge'">
    <mat-icon>compress</mat-icon>
  </button>
  <button mat-icon-button (click)="rollback()" *ngIf="mode.isEdit()" [matTooltip]="'markup.rollback'">
    <mat-icon>history</mat-icon>
  </button>
  <button mat-icon-button (click)="resetMarkup()" *ngIf="mode.isEdit()" [matTooltip]="'markup.reset'">
    <mat-icon>settings_backup_restore</mat-icon>
  </button>

  <div *ngIf="selection.isAnySelected()" class="arrow-control-container">
    <button mat-button (click)="selectionController?.moveLeft()" class="arrow-control">
      <mat-icon>navigate_before</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveUp()" class="arrow-control arrow-top">
      <mat-icon>expand_less</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveRight()" class="arrow-control arrow-right">
      <mat-icon>navigate_next</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveDown()" class="arrow-control arrow-down">
      <mat-icon>expand_more</mat-icon>
    </button>
  </div>
  <div *ngIf="selection.isAnySelected()" class="arrow-control-container-2">
    <button mat-button (click)="selectionController?.moveLeft2()" class="arrow-control">
      <mat-icon>navigate_before</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveUp2()" class="arrow-control arrow-top">
      <mat-icon>expand_less</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveRight2()" class="arrow-control arrow-right">
      <mat-icon>navigate_next</mat-icon>
    </button>
    <button mat-button (click)="selectionController?.moveDown2()" class="arrow-control arrow-down">
      <mat-icon>expand_more</mat-icon>
    </button>
  </div>
</div>
<div class="container">
  <div class="menu" [ngClass]="{ menu: true, hidden: !canvasDrawer?.canvasPainted }">
    <div class="canvas" [style.width.px]="image.offsetWidth" [style.height.px]="image.offsetHeight" #canvasContainer>
      <canvas #image [style.height.vh]="canvasHeight" [ngClass]="{
          'image-canvas': menu,
          'image-canvas-x-resize':
            canvasController?.x1Resize || canvasController?.x2Resize,
          'image-canvas-y-resize':
            canvasController?.y1Resize || canvasController?.y2Resize,
          'image-canvas-move': canvasController?.xyMove
        }">
      </canvas>
      <canvas #markup [style.height.vh]="canvasHeight" [ngClass]="{
          'markup-canvas': menu,
          'image-canvas-x-resize':
            canvasController?.x1Resize || canvasController?.x2Resize,
          'image-canvas-y-resize':
            canvasController?.y1Resize || canvasController?.y2Resize,
          'image-canvas-move': canvasController?.xyMove
        }">
      </canvas>
    </div>

    <button mat-icon-button (click)="deleteSelected()"
      [style.visibility]="mode.isEdit() && selection.isAnySelected() ? 'visible' : 'hidden'"
      class="canvas-delete-button" [style.top.px]="selection.getTopSelection(canvasContainer)"
      [style.left.px]="selection.getLeftSelection(canvasContainer) + 10">
      <mat-icon>clear</mat-icon>
    </button>
    <button mat-icon-button (click)="mergeSelection()" [style.visibility]="
        mode.isEdit() && selection.isAnySelected() ? 'visible' : 'hidden'
      " class="canvas-delete-button" [style.top.px]="selection.getTopSelection(canvasContainer)"
      [style.left.px]="selection.getLeftSelection(canvasContainer) + 35">
      <mat-icon>compress</mat-icon>
    </button>
  </div>

  <!-- Edit markup -->
  <div class="markup-setting" *ngIf="menu && mode.isEdit() && canvasDrawer?.canvasPainted"
    [style.height.vh]="canvasHeight">
    <div>
      <button mat-icon-button (click)="addLine(-1)" >
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <div *ngFor="let line of menu.pages![page.current].markup!; let i = index"
      (mouseover)="line.hover = true; redrawCanvas()" (mouseleave)="line.hover = false; redrawCanvas()"
      [id]="'line_' + i" class="dish-line-container">
      <div class="buttonBox">
        <button mat-icon-button (click)="removeLine(line)" *ngIf="line.hover" class="removeButton"
          >
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="buttonBox">
        <button mat-icon-button (click)="addLine(i)" *ngIf="line.hover" class="addButton">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      <mat-checkbox (change)="onLineSelected($event)" [(ngModel)]="line.editSelected"></mat-checkbox>
      <mat-form-field class="lineName">
        <input matInput [(ngModel)]="line.text" />
      </mat-form-field>
    </div>
  </div>

  <!-- View markup -->
  <div class="markup-setting" *ngIf="menu && mode.isView()" [style.height.vh]="canvasHeight">
    <table mat-table [dataSource]="menu.pages![page.current].markup!">
      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef>â„–</th>
        <td mat-cell *matCellDef="let line; let i = index">{{ i + 1 }}.</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef [translate]="'markup.dish.title'"></th>
        <td mat-cell *matCellDef="let line">{{ line.text }}</td>
      </ng-container>

      <ng-container matColumnDef="presence">
        <th mat-header-cell *matHeaderCellDef [translate]="'markup.dish.presence'"></th>
        <td mat-cell *matCellDef="let line">
          <mat-checkbox (change)="onLineSelected($event)" [(ngModel)]="line.viewSelected"></mat-checkbox>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>